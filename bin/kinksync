#!/usr/bin/env ruby
require 'bundler/setup'
require 'kinksync'

# -h or --help as argument
unless (ARGV & ['-h', '--help']).empty?
  STDOUT.puts <<-EOF
  Usage: kinksync [-h] [PATHS_LIST]

  Sync files located all over the directory tree in different computers using any cloud storage

  Without arguments:
    Sync all files under remote cloud path with local storage

  Optional arguments:
    -h, --help              Show this help message and exit
    [FILE_OR_PATHS_LIST]    Sync all files inside each path, or the file itself
  EOF
  exit
end

# normal execution
Kinksync.configure do |config|
  config.remote_path = '~/MEGA/kinksync'
end

puts "Using #{Kinksync.configuration.remote_path} as remote path."
puts 'Kinksyncing...'
synced = Kinksync.sync(ARGV)
puts 'Done!'
if synced.empty?
  puts 'All up to date, nothing synced.'
else
  puts 'Naughtily synced files:'
  synced.each { |f| puts f.sub(Kinksync.configuration.remote_path, '') }
end
